# Контроль лидов — инструкция и логика

Раздел **«Контроль лидов»** предназначен для управления пулом лидов, правилами их раздачи менеджерам и доступом к этому разделу.

---

## 1. Доступ к разделу

### Кто может зайти в «Контроль лидов»

- Пользователи с ролью **Директор** или **РОП** в админке лидов (портал).
- Пользователи, которым **выдан доступ по email личного кабинета** (список настраивается во вкладке **«Доступ к разделу»**).

Если у пользователя нет ни роли, ни записи в списке доступа — при переходе в раздел показывается экран **«Нет доступа»**.

### Роли

| Роль      | Возможности |
|-----------|-------------|
| **Директор** | Полный доступ: настройки раздачи, добавление/удаление менеджеров, выдача и снятие доступа к разделу. |
| **РОП**      | Просмотр облака лидов, назначение лидов вручную (если включён ручной режим и пользователь назначен распределителем). Добавлять менеджеров и выдавать доступ к разделу не может. |

---

## 2. Вкладки раздела

### 2.1. Облако лидов

Единый пул лидов с разбивкой по **типам аккаунтов (очередям)**:

- **Первичка**
- **Вторичка**
- **Аренда**
- **Рекламные кампании**

**Логика:**

- Все лиды попадают в облако и относятся к одному из четырёх типов.
- У каждого лида есть **стадия воронки** (новый, в работе, сделка и т.д.) и опционально **назначенный менеджер**.
- Блок **«Неназначенные лиды»** — лиды без менеджера. Их можно назначить вручную (если разрешено правилом и правами) или они будут разданы автоматически по правилу.
- Ниже — карточки по очередям: при клике открывается список лидов очереди. Из карточки лида можно назначить/сменить менеджера или изменить стадию (если есть права).

**Кто может назначать лидов вручную:** директор — всегда (для корректировки); при включённом ручном режиме — назначенный распределитель (менеджер из списка).

---

### 2.2. Настройки

Доступны **только директору**. РОП видит только пояснение, что настройки недоступны.

**Правило раздачи**

Единое правило для распределения **новых** лидов по менеджерам:

| Правило | Описание |
|---------|----------|
| **По кругу (round-robin)** | Лиды по каждой очереди поочерёдно назначаются менеджерам, привязанным к этой очереди. |
| **По загрузке** | Учитывается текущая загрузка менеджеров; лид назначается тому, у кого меньше нагрузка в рамках очереди. |
| **Только ручная раздача** | Автоматического назначения нет. Лиды остаются в «Неназначенных» до тех пор, пока распределитель (или директор) не назначит их вручную. |

**Менеджер в рукопашном режиме**

- Если выбрано правило «По кругу» или «По загрузке» — поле «Распределитель» не используется, лиды назначаются автоматически.
- Если выбрано «Только ручная раздача» — указывается **распределитель**: один из менеджеров по лидам, который вручную раздаёт неназначенные лиды. При выборе распределителя правило автоматически переключается на ручную раздачу.

---

### 2.3. Менеджеры

Список **менеджеров по лидам** — аккаунтов, которым можно назначать лидов из облака.

**Поля менеджера:** логин, имя, **очереди (типы лидов)**, к которым он привязан — Первичка, Вторичка, Аренда, Рекламные кампании. Можно выбрать несколько очередей.

**Логика:** лид из очереди «Первичка» может быть назначен только менеджеру, у которого в доступе есть «Первичка». Аналогично для остальных очередей.

**Добавлять и редактировать менеджеров может только директор.** РОП только просматривает список.

---

### 2.4. Доступ к разделу

Список пользователей, которым **открыт раздел «Контроль лидов»** (они видят облако, настройки, менеджеров, источники, аналитику). Пользователи задаются **по email личного кабинета**.

Для каждой записи указываются:

- Email личного кабинета
- Очередь (тип лидов) — к какой очереди привязан доступ (для учёта/фильтрации)
- Город (необязательно)

**Выдавать и снимать доступ может только директор.** Остальные пользователи с доступом к разделу видят список, но не могут добавлять или удалять записи.

---

### 2.5. Источник лидов

Статистика по **каналу поступления** лидов в облако: форма, реклама, партнёр, другое. Отображается количество лидов по каждому каналу; по клику на канал открывается список лидов с этим каналом и их статусы.

Используется для анализа, откуда приходят лиды; на логику раздачи не влияет.

---

### 2.6. Аналитика

- **Воронка продаж** по стадиям (новый, в работе, сделка и т.д.) — по всей сети или по выбранному менеджеру / неназначенным.
- **Объёмы по очередям** (первичка, вторичка, аренда, рекламные кампании).
- **Разбивка по менеджерам** и стадиям.

Период: неделя / месяц / всё время. Срез: все лиды / конкретный менеджер / неназначенные.

Данные по «всей сети» могут подтягиваться из API; по выбранному менеджеру воронка строится из текущего облака лидов.

---

## 3. Краткий сценарий использования

1. **Директор** заходит в «Контроль лидов».
2. **Настройки:** выбирает правило раздачи (по кругу / по загрузке / только вручную). При ручной раздаче назначает распределителя из списка менеджеров.
3. **Менеджеры:** добавляет менеджеров, указывает им очереди (первичка, вторичка и т.д.).
4. **Доступ к разделу:** добавляет по email ЛК тех, кому нужно видеть раздел (РОП и др.).
5. **Облако лидов:** просматривает неназначенные лиды; при автоматическом правиле новые лиды раздаются сами; при ручном — распределитель или директор назначает лидов из блока «Неназначенные лиды».
6. **Источник лидов** и **Аналитика** — для отчётов и контроля потоков.

---

## 4. Важные моменты

- **Облако единое** — все лиды в одном пуле с разметкой по очереди и стадии.
- **Раздача по правилу** действует при появлении нового лида (по кругу или по загрузке); уже лежащие в облаке лиды при смене правила не перераспределяются автоматически.
- **Доступ к разделу** и **менеджеры по лидам** — разные сущности: первые только видят интерфейс «Контроль лидов», вторые — те, кому назначаются лиды из облака.
- РОП может вручную назначать лидов только если включён режим ручной раздачи и он назначен распределителем.
